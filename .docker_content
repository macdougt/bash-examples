# Docker

# Docker functions

function dockerCleanFunction() {
   unconnected_images=$(docker image ls -a | grep "^<none>" | awk '{print $3}')
   if [ -z "$unconnected_images" ]
   then
      echo "Nothing to clean"
   else
      docker rmi $unconnected_images
   fi
}

alias dockerclean=dockerCleanFunction

function dockerKillFunction() {
  echo "Killing $*"
  docker stop $*;docker rm $*
}

alias dockerkill=dockerKillFunction

# List docker images matching regexp
function diFunction() {
  docker image ls -a | egrep "$1"
}

alias di=diFunction

function dirmFunction() {
  di $1
  # Prompt user for input
  echo -n "Kill the above images [y/N]? "
  read answer
  echo

  if [[ "$answer" == "y" || "$answer" == "Y" ]]; then
    echo "Performing kills now..."
    docker image ls | egrep "$1" | awk '{print $3}' | xargs docker rmi
  else
    echo "Just looking then"
  fi
}

alias dirm=dirmFunction

# Aliases

alias containers='docker container ls -a'
alias images='docker image ls'
alias dockerkillall='echo "Killing all containers";docker stop $(docker container ls -a -q);docker rm $(docker container ls -a -q)'
alias dls='docker image ls;docker container ls -a'
alias dockerls=dls
alias dockerlsc='docker container ls -a'
alias dockerkillexit='echo "Killing exited containers";docker container ls -aq -f status=exited | xargs docker rm'
alias dockerbash=docb
alias docbroot='docb --user root'
alias dockerstart=docs
alias dtc='dockerkillall;dockerclean'
